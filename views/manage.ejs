<%- include('partials/header') %>
<style>
  .manage-container {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
  }
  .form-group {
    margin-bottom: 15px;
  }
  .form-group label {
    font-weight: bold;
  }
  .category-table {
    margin-top: 20px;
  }
</style>
<h2 class="text-center mb-4">Manage Parking System</h2>
<div class="manage-container">
  <% if (error) { %>
    <div class="alert alert-danger text-center"><%= error %></div>
  <% } %>
  <% if (success) { %>
    <div class="alert alert-success text-center"><%= success %></div>
  <% } %>
  <!-- Set Lot Spaces -->
  <h4>Set Parking Lot Spaces</h4>
  <form action="/manage/set-lot-spaces" method="POST">
    <div class="form-group">
      <label for="total_spaces">Total Spaces:</label>
      <input type="number" class="form-control" id="total_spaces" name="total_spaces" required>
    </div>
    <button type="submit" class="btn btn-primary">Set Spaces</button>
  </form>
  <hr>
  <!-- Add/Edit Category -->
  <h4><%= editCategory ? 'Edit Category' : 'Add New Category' %></h4>
  <form action="<%= editCategory ? '/manage/edit/' + editCategory.id : '/manage/add-category' %>" method="POST">
    <div class="form-group">
      <label for="name">Category Name:</label>
      <input type="text" class="form-control" id="name" name="name" value="<%= editCategory ? editCategory.name : '' %>" required>
    </div>
    <div class="form-group">
      <label for="spaces_per_vehicle">Spaces per Vehicle:</label>
      <input type="number" class="form-control" id="spaces_per_vehicle" name="spaces_per_vehicle" value="<%= editCategory ? editCategory.spaces_per_vehicle : '1' %>" required>
    </div>
    <div class="form-group">
      <label for="pricing_type">Pricing Type:</label>
      <select class="form-control" id="pricing_type" name="pricing_type" required>
        <option value="hourly" <%= editCategory && editCategory.pricing_type === 'hourly' ? 'selected' : '' %>>Hourly</option>
        <option value="per-entry" <%= editCategory && editCategory.pricing_type === 'per-entry' ? 'selected' : '' %>>Per Entry</option>
      </select>
    </div>
    <div class="form-group">
      <label for="price">Price:</label>
      <input type="number" step="0.01" class="form-control" id="price" name="price" value="<%= editCategory ? editCategory.price : '0' %>" required>
    </div>
    <button type="submit" class="btn btn-primary"><%= editCategory ? 'Update Category' : 'Add Category' %></button>
    <% if (editCategory) { %>
      <a href="/manage" class="btn btn-secondary">Cancel</a>
    <% } %>
    <% if (validationErrors && validationErrors.length > 0) { %>
      <div class="alert alert-danger mt-2">
        <% validationErrors.forEach(error => { %>
          <p><%= error %></p>
        <% }) %>
      </div>
    <% } %>
  </form>
  <hr>
  <!-- Categories Table -->
  <h4>Vehicle Categories</h4>
  <table class="table table-bordered category-table">
    <thead>
      <tr>
        <th>Name</th>
        <th>Spaces per Vehicle</th>
        <th>Pricing Type</th>
        <th>Price</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <% if (categories && categories.length > 0) { %>
        <% categories.forEach(category => { %>
          <tr>
            <td><%= category.name %></td>
            <td><%= category.spaces_per_vehicle %></td>
            <td><%= category.pricing_type.charAt(0).toUpperCase() + category.pricing_type.slice(1) %></td>
            <td>PRK <%= category.price.toFixed(2) %></td>
            <td>
              <a href="/manage/edit/<%= category.id %>" class="btn btn-sm btn-primary">Edit</a>
              <form action="/manage/delete/<%= category.id %>" method="POST" style="display:inline;">
                <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this category?');">Delete</button>
              </form>
            </td>
          </tr>
        <% }) %>
      <% } else { %>
        <tr>
          <td colspan="5" class="text-center">No categories found.</td>
        </tr>
      <% } %>
    </tbody>
  </table>
</div>
<%- include('partials/footer') %>