<%- include('partials/header') %>
<h2>Manage System</h2>
<% if (error) { %>
  <div class="alert alert-danger"><%= error %></div>
<% } %>
<% if (validationErrors && validationErrors.length > 0) { %>
  <div class="alert alert-danger">
    <ul>
      <% validationErrors.forEach(error => { %>
        <li><%= error %></li>
      <% }) %>
    </ul>
  </div>
<% } %>
<% if (editCategory) { %>
  <h3>Edit Category</h3>
  <form action="/manage/edit/<%= editCategory.id %>" method="POST">
    <div class="mb-3">
      <label for="name" class="form-label">Category Name</label>
      <input type="text" class="form-control" id="name" name="name" value="<%= editCategory.name %>" required>
      <small class="form-text text-muted">1-50 characters, letters, numbers, and spaces only</small>
    </div>
    <div class="mb-3">
      <label for="total_spaces" class="form-label">Total Spaces</label>
      <input type="number" class="form-control" id="total_spaces" name="total_spaces" value="<%= editCategory.total_spaces %>" required>
      <small class="form-text text-muted">Positive integer</small>
    </div>
    <div class="mb-3">
      <label for="pricing_type" class="form-label">Pricing Type</label>
      <select class="form-select" id="pricing_type" name="pricing_type" required>
        <option value="hourly" <%= editCategory.pricing_type === 'hourly' ? 'selected' : '' %>>Hourly</option>
        <option value="per-entry" <%= editCategory.pricing_type === 'per-entry' ? 'selected' : '' %>>Per Entry</option>
      </select>
    </div>
    <div class="mb-3">
      <label for="price" class="form-label">Price ($)</label>
      <input type="number" class="form-control" id="price" name="price" value="<%= editCategory.price %>" step="0.01" required>
      <small class="form-text text-muted">Positive number</small>
    </div>
    <button type="submit" class="btn btn-primary">Update</button>
    <a href="/manage" class="btn btn-secondary">Cancel</a>
  </form>
<% } %>
<h3>Add New Category</h3>
<form action="/manage/add-category" method="POST">
  <div class="mb-3">
    <label for="name" class="form-label">Category Name</label>
    <input type="text" class="form-control" id="name" name="name" required>
    <small class="form-text text-muted">1-50 characters, letters, numbers, and spaces only</small>
  </div>
  <div class="mb-3">
    <label for="total_spaces" class="form-label">Total Spaces</label>
    <input type="number" class="form-control" id="total_spaces" name="total_spaces" required>
    <small class="form-text text-muted">Positive integer</small>
  </div>
  <div class="mb-3">
    <label for="pricing_type" class="form-label">Pricing Type</label>
    <select class="form-select" id="pricing_type" name="pricing_type" required>
      <option value="hourly">Hourly</option>
      <option value="per-entry">Per Entry</option>
    </select>
  </div>
  <div class="mb-3">
    <label for="price" class="form-label">Price ($)</label>
    <input type="number" class="form-control" id="price" name="price" step="0.01" required>
    <small class="form-text text-muted">Positive number</small>
  </div>
  <button type="submit" class="btn btn-primary">Add</button>
</form>
<% if (categories && categories.length > 0) { %>
  <h3 class="mt-4">Existing Categories</h3>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Name</th>
        <th>Total Spaces</th>
        <th>Pricing Type</th>
        <th>Price ($)</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      <% categories.forEach(category => { %>
        <tr>
          <td><%= category.name %></td>
          <td><%= category.total_spaces %></td>
          <td><%= category.pricing_type %></td>
          <td><%= category.price.toFixed(2) %></td>
          <td>
            <a href="/manage/edit/<%= category.id %>" class="btn btn-primary btn-sm">Edit</a>
            <form action="/manage/delete/<%= category.id %>" method="POST" style="display: inline;">
              <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this category?')">Delete</button>
            </form>
          </td>
        </tr>
      <% }) %>
    </tbody>
  </table>
<% } else { %>
  <p>No categories available.</p>
<% } %>
<%- include('partials/footer') %>